<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Camera Upload / Capture</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#f7f8fa;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0}
    .card{background:#fff;padding:1.5rem;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.08);width:360px;max-width:92%;text-align:center}
    button{background:#10a37f;color:#fff;border:0;padding:.7rem 1rem;border-radius:8px;cursor:pointer;font-size:1rem}
    button.secondary{background:#2b6ebb}
    video, img{width:100%;border-radius:10px;margin-top:1rem}
    .controls{display:flex;gap:.5rem;justify-content:center;margin-top:1rem}
    input[type=file]{display:none}
    .hint{font-size:.9rem;color:#556; margin-top:.5rem}
  </style>
</head>
<body>
  <div class="card">
    <h2>Take or Upload a Photo</h2>

    <!-- Hidden file input with capture attribute (mobile browsers will open camera) -->
    <input id="fileInput" type="file" accept="image/*" capture="environment" />

    <!-- Buttons to open file input or start live camera -->
    <div class="controls">
      <button id="openFile">üìÅ Upload</button>
      <button id="openCam" class="secondary">üì∑ Open Camera</button>
    </div>

    <div class="hint">If the browser supports direct camera access the live camera will appear; otherwise use Upload.</div>

    <!-- video for live preview, img for captured/static preview -->
    <video id="video" autoplay playsinline style="display:none"></video>
    <img id="preview" alt="Preview" style="display:none" />

    <div class="controls" id="captureControls" style="display:none">
      <button id="capture">üì∏ Capture</button>
      <button id="stop">‚èπ Stop</button>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const openFile = document.getElementById('openFile');
    const openCam = document.getElementById('openCam');
    const video = document.getElementById('video');
    const preview = document.getElementById('preview');
    const captureBtn = document.getElementById('capture');
    const stopBtn = document.getElementById('stop');
    const captureControls = document.getElementById('captureControls');

    // Open file picker (on mobile this may open camera)
    openFile.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', () => {
      const file = fileInput.files && fileInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        preview.src = e.target.result;
        preview.style.display = 'block';
        video.style.display = 'none';
        captureControls.style.display = 'none';
      };
      reader.readAsDataURL(file);
    });

    let stream = null;

    async function startCamera(){
      // Prefer the environment (rear) camera if available
      try{
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: 'environment' } } });
      }catch(e){
        // Fallback to any available camera
        try{ stream = await navigator.mediaDevices.getUserMedia({ video: true }); }catch(err){ stream = null; }
      }

      if(stream){
        video.srcObject = stream;
        video.style.display = 'block';
        preview.style.display = 'none';
        captureControls.style.display = 'flex';
      }else{
        alert('Unable to access camera. Use the Upload button as a fallback.');
      }
    }

    function stopCamera(){
      if(stream){
        stream.getTracks().forEach(t => t.stop());
        stream = null;
      }
      video.style.display = 'none';
      captureControls.style.display = 'none';
    }

    openCam.addEventListener('click', () => {
      // If getUserMedia is available, use it. Otherwise open file picker (mobile will open camera).
      if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia){
        startCamera();
      }else{
        fileInput.click();
      }
    });

    captureBtn.addEventListener('click', () => {
      if(!video || video.readyState < 2) return;
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      preview.src = canvas.toDataURL('image/png');
      preview.style.display = 'block';
      // stop the camera once captured (optional)
      stopCamera();
    });

    stopBtn.addEventListener('click', stopCamera);
  </script>
</body>
</html>
